<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Anaru's Workshop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', sans-serif;
        }
        h1, h2, h3 {
            font-family: 'Exo 2', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4 md:p-8">

        <!-- Login Section -->
        <div id="login-section" class="max-w-md mx-auto bg-gray-800 p-8 rounded-lg shadow-lg">
            <h1 class="text-3xl font-bold mb-6 text-center text-cyan-400">Workshop Control Panel</h1>
            <p id="auth-error" class="text-red-500 text-center mb-4"></p>
            <div class="mb-4">
                <label for="email" class="block mb-2 text-sm font-medium text-gray-300">Email</label>
                <input type="email" id="email" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5" placeholder="admin@workshop.com" required>
            </div>
            <div class="mb-6">
                <label for="password" class="block mb-2 text-sm font-medium text-gray-300">Password</label>
                <input type="password" id="password" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5" required>
            </div>
            <button id="login-button" class="w-full text-white bg-cyan-600 hover:bg-cyan-700 focus:ring-4 focus:outline-none focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Login</button>
        </div>

        <!-- Admin Content Section (hidden by default) -->
        <div id="admin-content" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-cyan-400">Project Dashboard</h1>
                <button id="logout-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Logout</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Project Log Uploader -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Add New Project Log</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="project-select-log" class="block mb-2 text-sm font-medium text-gray-300">Select Project</label>
                            <select id="project-select-log" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5">
                                <option value="anaru">Anaru (OwlHarpy)</option>
                                <option value="aurora">Aurora</option>
                                <option value="dr-darling">Dr. Darling</option>
                                <option value="snufkin">Snufkin (Moomin)</option>
                                <option value="alastor">Alastor (Hazbin Hotel)</option>
                                <option value="helldiver">Helldiver EX-03</option>
                                <option value="nms-traveler">NMS Traveler</option>
                                <option value="alan-wake">Alan Wake 2</option>
                                <option value="project-v60-t">Project V60-T</option>
                                <option value="larp-armory">LARP Armory</option>
                                <option value="prop-electronics-lab">Prop & Electronics Lab</option>
                            </select>
                        </div>
                        <div>
                            <label for="log-title" class="block mb-2 text-sm font-medium text-gray-300">Log Title (e.g., "Current Focus")</label>
                            <input type="text" id="log-title" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg block w-full p-2.5" placeholder="The Owl Wig">
                        </div>
                        <div>
                            <label for="log-content" class="block mb-2 text-sm font-medium text-gray-300">Log Content</label>
                            <textarea id="log-content" rows="4" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg block w-full p-2.5" placeholder="I have now ordered a wig and high-quality feathers..."></textarea>
                        </div>
                        <button id="add-log-button" class="w-full text-white bg-cyan-600 hover:bg-cyan-700 font-medium rounded-lg text-sm px-5 py-2.5">Add Log Entry</button>
                        <p id="log-success" class="text-green-400 text-center mt-2"></p>
                    </div>
                </div>

                <!-- Media Uploader -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Upload Media (Image/Video)</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="project-select-media" class="block mb-2 text-sm font-medium text-gray-300">Select Project</label>
                            <select id="project-select-media" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5">
                                <option value="anaru">Anaru (OwlHarpy)</option>
                                <option value="aurora">Aurora</option>
                                <option value="dr-darling">Dr. Darling</option>
                                <option value="snufkin">Snufkin (Moomin)</option>
                                <option value="alastor">Alastor (Hazbin Hotel)</option>
                                <option value="helldiver">Helldiver EX-03</option>
                                <option value="nms-traveler">NMS Traveler</option>
                                <option value="alan-wake">Alan Wake 2</option>
                                <option value="project-v60-t">Project V60-T</option>
                                <option value="larp-armory">LARP Armory</option>
                                <option value="prop-electronics-lab">Prop & Electronics Lab</option>
                            </select>
                        </div>
                        <div>
                            <label for="media-file" class="block mb-2 text-sm font-medium text-gray-300">Choose File</label>
                            <input type="file" id="media-file" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-cyan-500 file:text-white hover:file:bg-cyan-600">
                        </div>
                         <div>
                            <label for="media-description" class="block mb-2 text-sm font-medium text-gray-300">Description</label>
                            <input type="text" id="media-description" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg block w-full p-2.5" placeholder="Clothing concept art.">
                        </div>
                        <button id="upload-media-button" class="w-full text-white bg-cyan-600 hover:bg-cyan-700 font-medium rounded-lg text-sm px-5 py-2.5">Upload Media</button>
                        <div id="upload-status" class="mt-2 text-center"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        // *********************************************************************************
        // **IMPORTANT**: Replace this with your own Firebase project configuration!
        // You can get this from the Firebase console:
        // Project settings > General > Your apps > Web app > SDK setup and configuration
        // *********************************************************************************
        const firebaseConfig = {
             apiKey: "AIzaSyBQuF0P7leiyn3ddC1OfsElFyF6F9sZJzw",
             authDomain: "panel-aurora.firebaseapp.com",
             projectId: "panel-aurora",
              storageBucket: "panel-aurora.firebasestorage.app",
             messagingSenderId: "479594137457",
             appId: "1:479594137457:web:f3bae0817900e3126218d0",
             measurementId: "G-8LDTCPWL7V"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // DOM Elements
        const loginSection = document.getElementById('login-section');
        const adminContent = document.getElementById('admin-content');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const addLogButton = document.getElementById('add-log-button');
        const uploadMediaButton = document.getElementById('upload-media-button');
        const authError = document.getElementById('auth-error');
        const logSuccess = document.getElementById('log-success');

        // --- Authentication Logic ---
        onAuthStateChanged(auth, user => {
            if (user) {
                // User is signed in
                loginSection.classList.add('hidden');
                adminContent.classList.remove('hidden');
            } else {
                // User is signed out
                loginSection.classList.remove('hidden');
                adminContent.classList.add('hidden');
            }
        });

        loginButton.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            authError.textContent = '';
            
            signInWithEmailAndPassword(auth, email, password)
                .catch(error => {
                    console.error("Login Error:", error);
                    authError.textContent = 'Invalid email or password.';
                });
        });

        logoutButton.addEventListener('click', () => {
            signOut(auth);
        });

        // --- Add Project Log Logic ---
        addLogButton.addEventListener('click', async () => {
            const projectId = document.getElementById('project-select-log').value;
            const title = document.getElementById('log-title').value;
            const content = document.getElementById('log-content').value;

            if (!projectId || !title || !content) {
                alert('Please fill out all log fields.');
                return;
            }

            try {
                const docRef = await addDoc(collection(db, 'project-logs'), {
                    projectId: projectId,
                    title: title,
                    content: content,
                    timestamp: serverTimestamp()
                });
                console.log("Document written with ID: ", docRef.id);
                logSuccess.textContent = 'Log entry added successfully!';
                document.getElementById('log-title').value = '';
                document.getElementById('log-content').value = '';
                setTimeout(() => logSuccess.textContent = '', 3000);
            } catch (e) {
                console.error("Error adding document: ", e);
                logSuccess.textContent = 'Error adding log. Check console.';
            }
        });
        
        // --- Upload Media Logic ---
        uploadMediaButton.addEventListener('click', async () => {
            const projectId = document.getElementById('project-select-media').value;
            const file = document.getElementById('media-file').files[0];
            const description = document.getElementById('media-description').value;
            const statusDiv = document.getElementById('upload-status');

            if (!projectId || !file || !description) {
                alert('Please select a project, file, and add a description.');
                return;
            }

            statusDiv.innerHTML = `<p class="text-yellow-400">Uploading...</p>`;
            const fileType = file.type.split('/')[0]; // "image" or "video"
            const storageRef = ref(storage, `media/${projectId}/${file.name}`);

            try {
                // Upload file
                const snapshot = await uploadBytes(storageRef, file);
                // Get download URL
                const downloadURL = await getDownloadURL(snapshot.ref);

                // Save URL and metadata to Firestore
                await addDoc(collection(db, 'project-media'), {
                    projectId: projectId,
                    url: downloadURL,
                    description: description,
                    type: fileType, // 'image' or 'video'
                    fileName: file.name,
                    timestamp: serverTimestamp()
                });

                statusDiv.innerHTML = `<p class="text-green-400">Upload successful!</p>
                <p class="text-xs text-gray-400 mt-2">URL: ${downloadURL}</p>`;
                
                document.getElementById('media-file').value = '';
                document.getElementById('media-description').value = '';

            } catch(error) {
                console.error("Upload failed:", error);
                statusDiv.innerHTML = `<p class="text-red-500">Upload failed. See console for details.</p>`;
            }
        });

    </script>
</body>
</html>